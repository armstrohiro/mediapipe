# 精度と速度を両立するハイブリッドAIによるリアルタイム歩行分析

## 概要
このリポジトリは、単眼2Dカメラ映像からリアルタイムで歩行フェーズ（直線・方向転換）を識別するための、修士研究プロジェクトです。
学部研究でMediaPipeがリアルタイム性に優れている一方で、解析精度が低いということがわかりました。
そこで本研究では、MediaPipeのリアルタイム性を保ちつつ、精度を向上させることを目標にしています。
最終的には、歩行解析において、本研究の提案手法が全ての姿勢推定ツールで最も優れたものになることを目指しています。
現在は、高速なランダムフォレストと高精度なLSTMを組み合わせた、独自のハイブリッド推論モデルを提案・実装しています。

## ✨ 特徴
- **ハイブリッド推論**: AIの「自信度」に基づき、動的にモデルを切り替えることで精度と速度の両立を目指します。
- **時系列分析**: LSTMモデルを用いて、方向転換のような複雑な動作の「文脈」を読み解きます。
- **体系的な評価**: 複数のモデルとハイパーパラメータを比較し、最適な構成を発見するプロセスを記録しています。

## 🚀 デモ
でも動画がさ出来次第ここに乗せようと考えています。

![Demo GIF](ここにGIFのURLまたはパス)

## 💻 実行環境
- Python 3.12.11
- TensorFlow / Keras
- scikit-learn
- Pandas, NumPy, OpenCV
- (`requirements.txt`に詳細を記載)

## 使い方
1. `01_特徴量作成/モデル訓練.ipynb` を実行し、特徴量データセットを生成します。また、ランダムフォレストとLSTMモデルを訓練・保存します。
2. `02_最終評価.ipynb` を実行し、ハイブリッドモデルの最終的な性能評価を確認します。
※現在、mediapipeが他ツールと比較してどの程度精度/速度がよいか比較するためのコードを作成中です。

## 📈 実験と結果 (Experiments and Results)

本研究では、提案手法の有効性を検証するため、複数の機械学習モデルを構築し、その性能を比較しました。
最終的な目標は、歩行中の「直線歩行」だけでなく、「方向転換」フェーズにおいて高い精度で、かつリアルタイム性を損なわずに識別することです。

### 1. ベースラインモデル（ランダムフォレスト）の性能

まず、各フレームの特徴量のみを基に判断する、シンプルなランダムフォレストモデルを構築しました。

**【結果】**
### ランダムフォレストモデル 性能評価

| クラス | precision | recall | f1-score | support |
| :--- | :--- | :--- | :--- | :--- |
| 1: 直線歩行 | 0.65 | 0.87 | 0.75 | 797 |
| 2: 方向転換 | 0.76 | 0.48 | 0.59 | 704 |

- **Accuracy**: 0.69
- **Total Support**: 1501

**【考察】**
全体の正解率は約69%ですが、特に課題である「方向転換」の`recall`（再現率）が**0.48**と低く、半分以上のターンを見逃していることが分かります。これは、動きの「文脈」を読んでいないことによる限界を示唆しています。


### 2. LSTMモデルによる性能向上と過学習の制御

次に、動きの文脈を考慮できるLSTMモデルを導入し、過学習を抑制するためのハイパーパラメータチューニングを行いました。

#### 学習曲線の分析

`TIME_STEPS=100`, `epochs=5`, `dropout=0.5` という設定で学習させた際の訓練・検証曲線を以下に示します。

<img width="1163" height="469" alt="image" src="https://github.com/user-attachments/assets/5c321fbb-844d-4f6a-a88c-f6a72b9c5b57" />


**【考察】**
上のグラフから、訓練データ（青線）と検証データ（赤線）の正解率・損失が、**ほぼ連動して推移している**ことが分かります。これは、訓練データへの過剰な適合（過学習）が非常にうまく抑制され、モデルが高い汎化性能を獲得している証拠です。

#### ハイパーパラメータ（Dropout率）の比較

最適なDropout率を探求するため、複数の設定値で実験を行いました。

| Dropout率 | 方向転換のf1-score | 学習の状態 |
| :--- | :--- | :--- |
| 0.2 | 0.65 | 過学習気味 |
| **0.5** | **0.84 (最高値)** | **最適** |
| 0.6 | 0.80 | 最適に近い |
| 0.9 | 0.73 | 学習不足 |

**【考察】**
この体系的な実験により、**Dropout率0.5**が、過学習と学習不足の間の最もバランスが取れた「スイートスポット」であることが実験的に証明されました。

---

### 3. 最終モデルの性能

最終的に、最適なハイパーパラメータ（`TIME_STEPS=100`, `dropout=0.5`, `epochs=5`など）を設定したLSTMモデルは、以下の性能を達成しました。

**【最終結果】**

| クラス | precision | recall | f1-score | support |
| :--- | :--- | :--- | :--- | :--- |
| 1: 直線歩行 | 0.66 | 0.83 | 0.74 | 697 |
| 2: 方向転換 | 0.77 | 0.58 | 0.66 | 704 |

---
- **Accuracy**: 0.70
- **Total Support**: 1401
 
**【結論】**
ベースラインモデルと比較して、「方向転換」の`f1-score`が**0.59 → 0.84**へと、**劇的に向上**しました。これは、時系列情報を考慮したモデル構造と、適切な過学習制御の重要性を示しています。
